---
layout: post
title: "Vault: Данные под замком"
subtitle: "Инструмент ориентированный на безопастность и контроль данных"
date: 2019-12-23 13:37:00 +0300
background: '/img/posts/netdata-background.jpg'
---
# Vault: Данные под замком

Множество приложений, баз данных, серверов и иные сервисы имеют данные для доступа (Логин, пароль, сертификат и т.п.), 
колличество сервисов растет и управлять всем этим станвится все сложнее, но как быть если необходимо выдать доступ 
к определенному сервису и на опеределенный период при это сохранить усторию обращений к ключу? Одним из решений является
-[Vault](https://www.hashicorp.com/products/vault/).   

[Vault](https://www.hashicorp.com/products/vault/) позволяет решать такие проблемы как:
- Администрирование паролей, выдавать доступ лишь к тому что требуется.
- Возможность отозвать, продлить, перевыпустить ключь.
- Логгирование, каждое обращение, изминение, обновление ключа будет записано системой. 
- Масштабируемость и доступность 
- Низкий уровень входа для понимания разработчиками и администраторами
- Безопастность все ключи и пароли хранятся в зашифрованом виде
- Множество готовых решений для популярных систем
- ...Многое другое

### Установка

Vault распространяется под все поплурные системы: 
- MAC OS X
- WINDOWS
- LINUX
- FREEBSD
- NETBSD
- OPENBSD
- SOLARIS

Загрузить его можно на [официальном сайте](https://www.vaultproject.io/downloads.html)

##### Установка на Windows 

После загрузки архива размером 50MB~, в нем вы обнаружите один исполняемый файл. Наиболее простым решением является 
распаковать его в  `C:\Windows\system32`. Либо создать отдельную папку, распаковать в нее данный файл и прописать путь к 
папке через `"Переменные среды"` добавив путь в переменную `Path`.

##### Первые шаги

После того как Vault устновлен время приступить к созданию своего первого ключа для этого стоит запустить сервера 
разработки Vault:

```powershell
> vault.exe server -dev
```

Сервер разработки будет хранить все ваши секреты в оперативной памяти, но клиент не 
сможет подключиться к нему, так как мы не обеспечили безопастное соединение (HTTPS), эту проблемы можно решить явно
указав клиенту протокол небезопастное соединение HTTP - `$env:VAULT_ADDR="http://127.0.0.1:8200"`. Первым шагом запишем
простой ключь в хранилище: 

```powershell
>  vault.exe kv put secret/KeyName hello=word 
Key              Value
---              -----
created_time     2019-12-23T21:10:22.6628931Z
deletion_time    n/a
destroyed        false
version          1
```

Если более подробно говорить о том что произошло: 
1) `kv` - Указывает на тип хранилища в нашей случае Key-Value(Ключь-Значение)
2) `put` - Комманда указывающая на добавление
3) `secret/KeyName` - Имя "Коллекции"/"ИмяКлюча" куда сохранить. Коллекцию в данном случае, можно понимать как "базу 
данных" или "раздел" 
4) `hello=world` - hello - В данном случае является ключом, world - значение

Если вы попробуете повторно сделать запись нечего не изменив вы заметите что Vault повысит номер версии

```powershell
> vault.exe kv put secret/KeyName hello=world excited=yes
Key              Value
---              -----
created_time     2019-12-23T21:17:16.1989736Z
deletion_time    n/a
destroyed        false
version          2
```

Ваш первый ключь уже в хранилище! Но как получить его значение? Для этого нужно воспользовать коммандой: 

```powershell
> vault.exe kv get secret/KeyName
====== Metadata ======
Key              Value
---              -----
created_time     2019-12-23T21:17:17.1989736Z
deletion_time    n/a
destroyed        false
version          2

==== Data ====
Key      Value
---      -----
hello    world
```

Я думаю вывод комманды предельно понятен, но как получить лишь нужные данные, а именно значение нужного ключа? Для этого
используем явное указание интерисующего поля: 

```powershell
> vault.exe kv get -field=hello secret/KeyName
world
```

Так же часто бывает полезным получить иной формат ответа, например json: 

```powershell
> vault.exe kv get -format=json  secret/KeyName
{
  "request_id": "423c17c0-23be-5a12-cd75-c9334926b685",
  "lease_id": "",
  "lease_duration": 0,
  "renewable": false,
  "data": {
    "data": {
      "hello": "world"
    },
    "metadata": {
      "created_time": "2019-12-23T21:21:00.082784Z",
      "deletion_time": "",
      "destroyed": false,
      "version": 2
    }
  },
  "warnings": null
}
```

Расмотрим процесс удаления ключа из коллекции: 

```powershell
> vault.exe kv delete secret/KeyName
Success! Data deleted (if it existed) at: secret/KeyName
```
